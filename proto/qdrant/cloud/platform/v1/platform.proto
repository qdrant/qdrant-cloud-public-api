syntax = "proto3";

package qdrant.cloud.platform.v1;

import "buf/validate/validate.proto";
import "google/api/annotations.proto";
import "qdrant/cloud/common/v1/common.proto";

// PlatformService is the API used to query for cloud provider & regional information.
service PlatformService {
  // The API version of this service.
  option (qdrant.cloud.common.v1.api_version) = {
    major: 1
    minor: 0
    patch: 0
  };
  // Lists all available cloud providers globally (not account-specific).
  // Authentication is not required.
  rpc ListGlobalCloudProviders(ListGlobalCloudProvidersRequest) returns (ListGlobalCloudProvidersResponse) {
    // authentication not required
    option (qdrant.cloud.common.v1.requires_authentication) = false;
    // gRPC Gateway REST call
    option (google.api.http) = {get: "/api/platform/v1/cloud-providers"};
  }
  // Lists all cloud providers in the account identified by the given ID.
  // Required permissions:
  // - None (authenticated only)
  rpc ListCloudProviders(ListCloudProvidersRequest) returns (ListCloudProvidersResponse) {
    // permissions
    option (common.v1.permissions) = "";
    // gRPC Gateway REST call
    option (google.api.http) = {get: "/api/platform/v1/accounts/{account_id}/cloud-providers"};
  }
  // Lists all cloud provider regions (not account-specific) identified by cloud provider ID.
  // Authentication is not required.
  rpc ListGlobalCloudProviderRegions(ListGlobalCloudProviderRegionsRequest) returns (ListGlobalCloudProviderRegionsResponse) {
    // authentication not required
    option (qdrant.cloud.common.v1.requires_authentication) = false;
    // gRPC Gateway REST call
    option (google.api.http) = {get: "/api/platform/v1/cloud-providers/{cloud_provider_id}/regions"};
    // log fields
    option (common.v1.log_fields) = {
      name: "cloud_provider_id"
      field_expression: "cloud_provider_id"
    };
  }
  // Gets a specific cloud provider region (not account-specific) identified by cloud provider ID and region ID.
  // Authentication is not required.
  rpc GetGlobalCloudProviderRegion(GetGlobalCloudProviderRegionRequest) returns (GetGlobalCloudProviderRegionResponse) {
    // authentication not required
    option (qdrant.cloud.common.v1.requires_authentication) = false;
    // gRPC Gateway REST call
    option (google.api.http) = {get: "/api/platform/v1/cloud-providers/{cloud_provider_id}/regions/{region_id}"};
    // log fields
    option (common.v1.log_fields) = {
      name: "cloud_provider_id"
      field_expression: "cloud_provider_id"
    };
    option (common.v1.log_fields) = {
      name: "region_id"
      field_expression: "region_id"
    };
  }
  // Lists all cloud provider regions in the account identified by the given ID and cloud provider.
  // Required permissions:
  // - None (authenticated only)
  // Conditional permissions:
  // - read:hybrid_cloud_environments OR read:clusters
  //   One of these permissions is required when the specified cloud_provider_id is "hybrid".
  rpc ListCloudProviderRegions(ListCloudProviderRegionsRequest) returns (ListCloudProviderRegionsResponse) {
    // permissions
    option (common.v1.permissions) = "";
    // gRPC Gateway REST call
    option (google.api.http) = {get: "/api/platform/v1/accounts/{account_id}/cloud-providers/{cloud_provider_id}/regions"};
    // log fields
    option (common.v1.log_fields) = {
      name: "cloud_provider_id"
      field_expression: "cloud_provider_id"
    };
  }
  // Gets a specific cloud provider region in the account identified by the given ID and cloud provider.
  // Required permissions:
  // - None (authenticated only)
  // Conditional permissions:
  // - read:hybrid_cloud_environments OR read:clusters
  //   One of these permissions is required when the specified cloud_provider_id is "hybrid".
  rpc GetCloudProviderRegion(GetCloudProviderRegionRequest) returns (GetCloudProviderRegionResponse) {
    // permissions
    option (common.v1.permissions) = "";
    // gRPC Gateway REST call
    option (google.api.http) = {get: "/api/platform/v1/accounts/{account_id}/cloud-providers/{cloud_provider_id}/regions/{region_id}"};
    // log fields
    option (common.v1.log_fields) = {
      name: "cloud_provider_id"
      field_expression: "cloud_provider_id"
    };
    option (common.v1.log_fields) = {
      name: "region_id"
      field_expression: "region_id"
    };
  }
}

// ListCloudProvidersRequest is the request for the ListCloudProviders function.
message ListCloudProvidersRequest {
  // The identifier of the account (in GUID format).
  // This is a required field.
  string account_id = 1 [(buf.validate.field).string = {uuid: true}];
}

// ListCloudProvidersResponse is the response from the ListCloudProviders function.
message ListCloudProvidersResponse {
  // The cloud providers
  repeated CloudProvider items = 1;
}

// buf:lint:ignore QDRANT_CLOUD_REQUIRED_REQUEST_FIELDS
// ListGlobalCloudProvidersRequest is the request from the ListGlobalCloudProviders function.
message ListGlobalCloudProvidersRequest {}

// ListGlobalCloudProvidersResponse is the response from the ListGlobalCloudProviders function.
message ListGlobalCloudProvidersResponse {
  // The cloud providers
  repeated CloudProvider items = 1;
}

// buf:lint:ignore QDRANT_CLOUD_REQUIRED_REQUEST_FIELDS
// ListGlobalCloudProviderRegionsRequest is the request for the ListGlobalCloudProviderRegions function.
message ListGlobalCloudProviderRegionsRequest {
  // The identifier for the cloud provider. One of the providers from response of the ListCloudProviders function.
  // This is a required field.
  string cloud_provider_id = 1 [(buf.validate.field).string = {min_len: 3}];
}

// ListGlobalCloudProviderRegionsResponse is the response from the ListGlobalCloudProviderRegions function.
message ListGlobalCloudProviderRegionsResponse {
  // The cloud provider regions.
  repeated CloudProviderRegion items = 1;
}

// buf:lint:ignore QDRANT_CLOUD_REQUIRED_REQUEST_FIELDS
// GetGlobalCloudProviderRegionRequest is the request for the GetGlobalCloudProviderRegion function.
message GetGlobalCloudProviderRegionRequest {
  // The identifier for the cloud provider. One of the providers from response of the ListCloudProviders function.
  // This is a required field.
  string cloud_provider_id = 1 [(buf.validate.field).string = {min_len: 3}];
  // The identifier for the cloud provider region.
  // This is a required field.
  string region_id = 2 [(buf.validate.field).string = {min_len: 1}];
}

// GetGlobalCloudProviderRegionResponse is the response from the GetGlobalCloudProviderRegion function.
message GetGlobalCloudProviderRegionResponse {
  // The cloud provider region.
  CloudProviderRegion region = 1;
}

// ListCloudProviderRegionsRequest is the request for the ListCloudProviderRegions function.
message ListCloudProviderRegionsRequest {
  // The identifier of the account (in GUID format).
  // This is a required field.
  string account_id = 1 [(buf.validate.field).string = {uuid: true}];
  // The identifier for the cloud provider. One of the providers from response of the ListCloudProviders function.
  // This is a required field.
  string cloud_provider_id = 2 [(buf.validate.field).string = {min_len: 3}];
}

// ListCloudProviderRegionsResponse is the response from the ListCloudProviderRegions function.
message ListCloudProviderRegionsResponse {
  // The cloud provider regions.
  repeated CloudProviderRegion items = 1;
}

// GetCloudProviderRegionRequest is the request for the GetCloudProviderRegion function.
message GetCloudProviderRegionRequest {
  // The identifier of the account (in GUID format).
  // This is a required field.
  string account_id = 1 [(buf.validate.field).string = {uuid: true}];
  // The identifier for the cloud provider. One of the providers from response of the ListCloudProviders function.
  // This is a required field.
  string cloud_provider_id = 2 [(buf.validate.field).string = {min_len: 3}];
  // The identifier for the cloud provider region.
  // This is a required field.
  string region_id = 3 [(buf.validate.field).string = {min_len: 1}];
}

// GetCloudProviderRegionResponse is the response from the GetCloudProviderRegion function.
message GetCloudProviderRegionResponse {
  // The cloud provider region.
  CloudProviderRegion region = 1;
}

// buf:lint:ignore QDRANT_CLOUD_REQUIRED_ENTITY_FIELDS
// CloudProvider represents a cloud provider identifier and name.
message CloudProvider {
  // The identifier for the cloud provider.
  // e.g. "aws", "gcp", "azure", "hybrid".
  string id = 1 [(buf.validate.field).string.min_len = 3];
  // The human-readable name of the cloud provider.
  // e.g. "Amazon Web Services", "Google Cloud", "Microsoft Azure", "Hybrid Cloud".
  string name = 2 [(buf.validate.field).string.min_len = 1];
  // Whether the cloud provider is part of the free-tier offering.
  bool free_tier = 3;
  // Indicates whether the cloud provider is available for the use case.
  bool available = 4;
}

// buf:lint:ignore QDRANT_CLOUD_REQUIRED_ENTITY_FIELDS
// CloudProviderRegion represents a cloud provider region.
message CloudProviderRegion {
  // The identifier for the cloud provider region.
  // e.g. "us-west-1", "europe-west1", "eastus", "{UUID in case of hybrid cloud}".
  string id = 1 [(buf.validate.field).string.min_len = 1];
  // The human-readable name of the cloud provider region.
  // e.g. "Frankfurt", "Tokyo", etc.
  string name = 2 [(buf.validate.field).string.min_len = 1];
  // Whether the cloud region is part of the free-tier offering.
  bool free_tier = 3;
  // Indicates whether the cloud region is available or the hybrid cloud region is ready for clusters.
  bool available = 4;
  // The identifier for the cloud provider.
  // e.g. "aws", "gcp", "azure", "openshift", "linode", "unknown".
  string provider = 5 [(buf.validate.field).string.min_len = 1];
  // ISO 3166-1 alpha-2 country codes for different countries to display for each region.
  optional string country_iso_code = 6 [(buf.validate.field).string = {
    len: 2
    pattern: "^[A-Z]{2}$"
  }];
  // Geographic location grouping of the region.
  // e.g. "Europe", "Asia", "North America", etc.
  optional string geographical_sub_region = 7 [(buf.validate.field).string.min_len = 1];
  // Kubernetes namespace where the components for the environment are deployed (for hybrid cloud regions).
  optional string namespace = 8 [(buf.validate.field).string.min_len = 1];
  // Storage capabilities available in this region.
  CloudProviderRegionCapabilities capabilities = 9;
}

// CloudProviderRegionCapabilities represents storage capabilities available in a cloud provider region.
message CloudProviderRegionCapabilities {
  // Whether volume snapshots are supported.
  bool volume_snapshot = 1;
  // Whether volume expansion is supported.
  bool volume_expansion = 2;
}
